#!/usr/bin/env bash

set -euo pipefail

if [[ ! -f "/usr/local/lib/clilog/functions.sh" ]]; then
	echo "Error: Clilog is not installed yet, run the script install.sh for installation."
fi

source "/usr/local/lib/clilog/functions.sh"
source "$HOME/Projects/clilog/src/interactive.sh"

COMMAND="${1:-}"

case "$COMMAND" in
    add|done|undo|del|search|edit)
        if [ $# -lt 2 ]; then
            echo "Error: The command '$COMMAND' requires arguments. Try 'clilog $COMMAND <value>'."
            exit 1
        fi
        shift 
        ;;
    list|clear|version|help|tag|interactive)
        ;;
    *)
        _clilog_show_help
	;;
esac

_clilog_setup

case "$COMMAND" in
    add)
        _clilog_add_note "$@"
        ;;
    list)
        _clilog_list_notes
        ;;
    done)
        _clilog_mark_done "$@"
        ;;
    tag)
    	subcmd="${2:-}"  # pega o segundo argumento de fato
    	note_id="${3:-}" # terceiro argumento
    	tag_name="${4:-}" # quarto argumento (ou new tag se move)
    
   	 case "$subcmd" in
        	add|remove|move)
            		_clilog_tag_notes "$subcmd" "$note_id" "$tag_name" "${5:-}"
            		;;
        	*)
            		echo "Error: Invalid tag command. Use add, remove, or move."
            		exit 1
            		;;
         esac
   	 ;;

    undo)
        _clilog_undo "$@"
        ;;
    clear)
        _clilog_clear_notes
        ;;
    del)
        _clilog_del_line "$@"
        ;;
    help)
    	_clilog_show_help
	;;
    version)
        _clilog_show_version
        ;;
    search)
    	_clilog_search_notes "$@"
	;;
    edit)
	_clilog_edit_notes "$@"
	;;
    interactive)
    	main_menu
	;;
esac

